import { strict as assert } from "node:assert";
import { simplifyTrack } from "../plugin/index.js";

describe("sample track", function () {
  it("should simplify from 71 points to 31", () => {
    var testTrack = [
      {
        latitude: -16.472205,
        longitude: -145.42179,
        time: "2025-10-10T23:23:53.000Z",
        depth: 22.3,
      },
      {
        latitude: -16.471255,
        longitude: -145.420802,
        time: "2025-10-10T23:24:53.000Z",
        depth: 25.9,
      },
      {
        latitude: -16.469448,
        longitude: -145.419671,
        time: "2025-10-10T23:26:31.000Z",
        depth: 25.9,
      },
      {
        latitude: -16.46831,
        longitude: -145.419035,
        time: "2025-10-10T23:27:32.000Z",
        depth: 26.3,
      },
      {
        latitude: -16.46733,
        longitude: -145.418188,
        time: "2025-10-10T23:28:32.000Z",
        depth: 25.1,
      },
      {
        latitude: -16.466448,
        longitude: -145.417312,
        time: "2025-10-10T23:29:32.000Z",
        depth: 25.2,
      },
      {
        latitude: -16.465496,
        longitude: -145.416434,
        time: "2025-10-10T23:30:32.000Z",
        depth: 26.4,
      },
      {
        latitude: -16.464501,
        longitude: -145.415591,
        time: "2025-10-10T23:31:32.000Z",
        depth: 24.9,
      },
      {
        latitude: -16.463851,
        longitude: -145.414461,
        time: "2025-10-10T23:32:32.000Z",
        depth: 25.3,
      },
      {
        latitude: -16.463097,
        longitude: -145.413434,
        time: "2025-10-10T23:33:32.000Z",
        depth: 24.9,
      },
      {
        latitude: -16.46234,
        longitude: -145.412344,
        time: "2025-10-10T23:34:32.000Z",
        depth: 26.3,
      },
      {
        latitude: -16.46163,
        longitude: -145.411273,
        time: "2025-10-10T23:35:32.000Z",
        depth: 24.9,
      },
      {
        latitude: -16.460783,
        longitude: -145.410335,
        time: "2025-10-10T23:36:32.000Z",
        depth: 24.4,
      },
      {
        latitude: -16.45996,
        longitude: -145.40933,
        time: "2025-10-10T23:37:32.000Z",
        depth: 29.6,
      },
      {
        latitude: -16.45896,
        longitude: -145.408501,
        time: "2025-10-10T23:38:32.000Z",
        depth: 26.3,
      },
      {
        latitude: -16.458034,
        longitude: -145.407641,
        time: "2025-10-10T23:39:32.000Z",
        depth: 28.1,
      },
      {
        latitude: -16.457206,
        longitude: -145.40667,
        time: "2025-10-10T23:40:32.000Z",
        depth: 26.5,
      },
      {
        latitude: -16.456436,
        longitude: -145.405541,
        time: "2025-10-10T23:41:32.000Z",
        depth: 28.1,
      },
      {
        latitude: -16.455626,
        longitude: -145.404485,
        time: "2025-10-10T23:42:32.000Z",
        depth: 31.5,
      },
      {
        latitude: -16.454738,
        longitude: -145.403468,
        time: "2025-10-10T23:43:32.000Z",
        depth: 31.1,
      },
      {
        latitude: -16.45376,
        longitude: -145.402542,
        time: "2025-10-10T23:44:32.000Z",
        depth: 27.6,
      },
      {
        latitude: -16.452746,
        longitude: -145.401739,
        time: "2025-10-10T23:45:32.000Z",
        depth: 32.7,
      },
      {
        latitude: -16.451846,
        longitude: -145.400825,
        time: "2025-10-10T23:46:32.000Z",
        depth: 29.3,
      },
      {
        latitude: -16.450911,
        longitude: -145.399902,
        time: "2025-10-10T23:47:32.000Z",
        depth: 29.5,
      },
      {
        latitude: -16.449893,
        longitude: -145.399078,
        time: "2025-10-10T23:48:32.000Z",
        depth: 28.8,
      },
      {
        latitude: -16.448865,
        longitude: -145.398281,
        time: "2025-10-10T23:49:32.000Z",
        depth: 32.1,
      },
      {
        latitude: -16.448055,
        longitude: -145.397218,
        time: "2025-10-10T23:50:32.000Z",
        depth: 38.3,
      },
      {
        latitude: -16.447261,
        longitude: -145.39609,
        time: "2025-10-10T23:51:32.000Z",
        depth: 32.8,
      },
      {
        latitude: -16.446393,
        longitude: -145.39514,
        time: "2025-10-10T23:52:32.000Z",
        depth: 30.0,
      },
      {
        latitude: -16.445397,
        longitude: -145.394359,
        time: "2025-10-10T23:53:32.000Z",
        depth: 29.8,
      },
      {
        latitude: -16.444368,
        longitude: -145.393457,
        time: "2025-10-10T23:54:32.000Z",
        depth: 29.4,
      },
      {
        latitude: -16.443302,
        longitude: -145.392708,
        time: "2025-10-10T23:55:32.000Z",
        depth: 34.5,
      },
      {
        latitude: -16.442239,
        longitude: -145.391898,
        time: "2025-10-10T23:56:32.000Z",
        depth: 29.8,
      },
      {
        latitude: -16.441296,
        longitude: -145.390933,
        time: "2025-10-10T23:57:32.000Z",
        depth: 22.5,
      },
      {
        latitude: -16.440328,
        longitude: -145.389888,
        time: "2025-10-10T23:58:32.000Z",
        depth: 25.8,
      },
      {
        latitude: -16.439311,
        longitude: -145.388943,
        time: "2025-10-10T23:59:32.000Z",
        depth: 25.6,
      },
      {
        latitude: -16.4384,
        longitude: -145.387883,
        time: "2025-10-11T00:00:32.000Z",
        depth: 26.8,
      },
      {
        latitude: -16.437508,
        longitude: -145.38692,
        time: "2025-10-11T00:01:32.000Z",
        depth: 27.7,
      },
      {
        latitude: -16.436457,
        longitude: -145.386264,
        time: "2025-10-11T00:02:32.000Z",
        depth: 28.4,
      },
      {
        latitude: -16.435513,
        longitude: -145.385311,
        time: "2025-10-11T00:03:32.000Z",
        depth: 25.9,
      },
      {
        latitude: -16.434623,
        longitude: -145.384302,
        time: "2025-10-11T00:04:32.000Z",
        depth: 24.9,
      },
      {
        latitude: -16.433926,
        longitude: -145.383135,
        time: "2025-10-11T00:05:32.000Z",
        depth: 25.4,
      },
      {
        latitude: -16.433238,
        longitude: -145.381968,
        time: "2025-10-11T00:06:32.000Z",
        depth: 26.7,
      },
      {
        latitude: -16.432652,
        longitude: -145.38079,
        time: "2025-10-11T00:07:32.000Z",
        depth: 27.5,
      },
      {
        latitude: -16.431826,
        longitude: -145.379735,
        time: "2025-10-11T00:08:32.000Z",
        depth: 24.2,
      },
      {
        latitude: -16.431043,
        longitude: -145.378645,
        time: "2025-10-11T00:09:32.000Z",
        depth: 20.2,
      },
      {
        latitude: -16.430376,
        longitude: -145.377566,
        time: "2025-10-11T00:10:32.000Z",
        depth: 14.8,
      },
      {
        latitude: -16.431435,
        longitude: -145.377384,
        time: "2025-10-11T00:11:32.000Z",
        depth: 18.1,
      },
      {
        latitude: -16.432811,
        longitude: -145.377063,
        time: "2025-10-11T00:12:32.000Z",
        depth: 18.9,
      },
      {
        latitude: -16.434221,
        longitude: -145.376882,
        time: "2025-10-11T00:13:33.000Z",
        depth: 19.3,
      },
      {
        latitude: -16.435568,
        longitude: -145.376697,
        time: "2025-10-11T00:14:33.000Z",
        depth: 21.0,
      },
      {
        latitude: -16.436983,
        longitude: -145.376568,
        time: "2025-10-11T00:15:33.000Z",
        depth: 16.4,
      },
      {
        latitude: -16.438408,
        longitude: -145.376391,
        time: "2025-10-11T00:16:33.000Z",
        depth: 22.1,
      },
      {
        latitude: -16.439768,
        longitude: -145.37626,
        time: "2025-10-11T00:17:33.000Z",
        depth: 21.4,
      },
      {
        latitude: -16.441138,
        longitude: -145.376141,
        time: "2025-10-11T00:18:33.000Z",
        depth: 21.6,
      },
      {
        latitude: -16.442516,
        longitude: -145.375958,
        time: "2025-10-11T00:19:33.000Z",
        depth: 20.3,
      },
      {
        latitude: -16.443876,
        longitude: -145.375665,
        time: "2025-10-11T00:20:33.000Z",
        depth: 18.7,
      },
      {
        latitude: -16.445172,
        longitude: -145.375181,
        time: "2025-10-11T00:21:33.000Z",
        depth: 21.5,
      },
      {
        latitude: -16.44645,
        longitude: -145.374665,
        time: "2025-10-11T00:22:33.000Z",
        depth: 21.1,
      },
      {
        latitude: -16.447806,
        longitude: -145.374302,
        time: "2025-10-11T00:23:33.000Z",
        depth: 19.3,
      },
      {
        latitude: -16.44915,
        longitude: -145.373903,
        time: "2025-10-11T00:24:33.000Z",
        depth: 17.5,
      },
      {
        latitude: -16.450503,
        longitude: -145.373433,
        time: "2025-10-11T00:25:33.000Z",
        depth: 17.3,
      },
      {
        latitude: -16.451876,
        longitude: -145.372999,
        time: "2025-10-11T00:26:33.000Z",
        depth: 14.6,
      },
      {
        latitude: -16.453211,
        longitude: -145.372469,
        time: "2025-10-11T00:27:33.000Z",
        depth: 11.6,
      },
      {
        latitude: -16.454626,
        longitude: -145.372157,
        time: "2025-10-11T00:28:33.000Z",
        depth: 10.1,
      },
      {
        latitude: -16.454337,
        longitude: -145.371447,
        time: "2025-10-11T00:29:33.000Z",
        depth: 10.1,
      },
      {
        latitude: -16.453282,
        longitude: -145.370523,
        time: "2025-10-11T00:30:33.000Z",
        depth: 10.3,
      },
      {
        latitude: -16.452464,
        longitude: -145.369704,
        time: "2025-10-11T00:31:33.000Z",
        depth: 10.9,
      },
      {
        latitude: -16.452548,
        longitude: -145.369124,
        time: "2025-10-11T00:33:33.000Z",
        depth: 7.9,
      },
      {
        latitude: -16.4525,
        longitude: -145.368535,
        time: "2025-10-11T00:35:33.000Z",
        depth: 3.1,
      },
      {
        latitude: -16.452467,
        longitude: -145.36866,
        time: "2025-10-11T00:38:33.000Z",
        depth: 3.7,
      },
    ];
    var expected = [
      {
        latitude: -16.472205,
        longitude: -145.42179,
        time: "2025-10-10T23:23:53.000Z",
        depth: 22.3,
        x: -16188279.613046361,
        y: -1859472.0892968778,
      },
      {
        latitude: -16.471255,
        longitude: -145.420802,
        time: "2025-10-10T23:24:53.000Z",
        depth: 25.9,
        x: -16188169.62938946,
        y: -1859361.809886332,
      },
      {
        latitude: -16.46831,
        longitude: -145.419035,
        time: "2025-10-10T23:27:32.000Z",
        depth: 26.3,
        x: -16187972.927849228,
        y: -1859019.9471491775,
      },
      {
        latitude: -16.464501,
        longitude: -145.415591,
        time: "2025-10-10T23:31:32.000Z",
        depth: 24.9,
        x: -16187589.543522935,
        y: -1858577.7969017725,
      },
      {
        latitude: -16.46163,
        longitude: -145.411273,
        time: "2025-10-10T23:35:32.000Z",
        depth: 24.9,
        x: -16187108.865961691,
        y: -1858244.5358121558,
      },
      {
        latitude: -16.45996,
        longitude: -145.40933,
        time: "2025-10-10T23:37:32.000Z",
        depth: 29.6,
        x: -16186892.57219108,
        y: -1858050.687152209,
      },
      {
        latitude: -16.458034,
        longitude: -145.407641,
        time: "2025-10-10T23:39:32.000Z",
        depth: 28.1,
        x: -16186704.553571131,
        y: -1857827.124842326,
      },
      {
        latitude: -16.454738,
        longitude: -145.403468,
        time: "2025-10-10T23:43:32.000Z",
        depth: 31.1,
        x: -16186240.01733605,
        y: -1857444.54360978,
      },
      {
        latitude: -16.452746,
        longitude: -145.401739,
        time: "2025-10-10T23:45:32.000Z",
        depth: 32.7,
        x: -16186047.545936465,
        y: -1857213.3265503496,
      },
      {
        latitude: -16.450911,
        longitude: -145.399902,
        time: "2025-10-10T23:47:32.000Z",
        depth: 29.5,
        x: -16185843.05203188,
        y: -1857000.3350244968,
      },
      {
        latitude: -16.448865,
        longitude: -145.398281,
        time: "2025-10-10T23:49:32.000Z",
        depth: 32.1,
        x: -16185662.603137305,
        y: -1856762.8547499147,
      },
      {
        latitude: -16.447261,
        longitude: -145.39609,
        time: "2025-10-10T23:51:32.000Z",
        depth: 32.8,
        x: -16185418.702132976,
        y: -1856576.6793940035,
      },
      {
        latitude: -16.446393,
        longitude: -145.39514,
        time: "2025-10-10T23:52:32.000Z",
        depth: 30,
        x: -16185312.948616723,
        y: -1856475.931775686,
      },
      {
        latitude: -16.442239,
        longitude: -145.391898,
        time: "2025-10-10T23:56:32.000Z",
        depth: 29.8,
        x: -16184952.050827568,
        y: -1855993.788696541,
      },
      {
        latitude: -16.437508,
        longitude: -145.38692,
        time: "2025-10-11T00:01:32.000Z",
        depth: 27.7,
        x: -16184397.902402401,
        y: -1855444.6874173507,
      },
      {
        latitude: -16.436457,
        longitude: -145.386264,
        time: "2025-10-11T00:02:32.000Z",
        depth: 28.4,
        x: -16184324.876816444,
        y: -1855322.7054150656,
      },
      {
        latitude: -16.435513,
        longitude: -145.385311,
        time: "2025-10-11T00:03:32.000Z",
        depth: 25.9,
        x: -16184218.789341714,
        y: -1855213.1426950416,
      },
      {
        latitude: -16.434623,
        longitude: -145.384302,
        time: "2025-10-11T00:04:32.000Z",
        depth: 24.9,
        x: -16184106.467975505,
        y: -1855109.8478216815,
      },
      {
        latitude: -16.432652,
        longitude: -145.38079,
        time: "2025-10-11T00:07:32.000Z",
        depth: 27.5,
        x: -16183715.513923837,
        y: -1854881.0919834217,
      },
      {
        latitude: -16.430376,
        longitude: -145.377566,
        time: "2025-10-11T00:10:32.000Z",
        depth: 14.8,
        x: -16183356.619885521,
        y: -1854616.9404883506,
      },
      {
        latitude: -16.432811,
        longitude: -145.377063,
        time: "2025-10-11T00:12:32.000Z",
        depth: 18.9,
        x: -16183300.626181653,
        y: -1854899.5455646727,
      },
      {
        latitude: -16.441138,
        longitude: -145.376141,
        time: "2025-10-11T00:18:33.000Z",
        depth: 21.6,
        x: -16183197.98961114,
        y: -1855866.0004573697,
      },
      {
        latitude: -16.443876,
        longitude: -145.375665,
        time: "2025-10-11T00:20:33.000Z",
        depth: 18.7,
        x: -16183145.001533523,
        y: -1856183.7894437017,
      },
      {
        latitude: -16.44645,
        longitude: -145.374665,
        time: "2025-10-11T00:22:33.000Z",
        depth: 21.1,
        x: -16183033.682042727,
        y: -1856482.5476768913,
      },
      {
        latitude: -16.44915,
        longitude: -145.373903,
        time: "2025-10-11T00:24:33.000Z",
        depth: 17.5,
        x: -16182948.856590746,
        y: -1856795.934696715,
      },
      {
        latitude: -16.453211,
        longitude: -145.372469,
        time: "2025-10-11T00:27:33.000Z",
        depth: 11.6,
        x: -16182789.224440949,
        y: -1857267.3001997015,
      },
      {
        latitude: -16.454626,
        longitude: -145.372157,
        time: "2025-10-11T00:28:33.000Z",
        depth: 10.1,
        x: -16182754.49275982,
        y: -1857431.5433908375,
      },
      {
        latitude: -16.454337,
        longitude: -145.371447,
        time: "2025-10-11T00:29:33.000Z",
        depth: 10.1,
        x: -16182675.455921356,
        y: -1857397.9982176987,
      },
      {
        latitude: -16.452464,
        longitude: -145.369704,
        time: "2025-10-11T00:31:33.000Z",
        depth: 10.9,
        x: -16182481.426048907,
        y: -1857180.5942066591,
      },
      {
        latitude: -16.4525,
        longitude: -145.368535,
        time: "2025-10-11T00:35:33.000Z",
        depth: 3.1,
        x: -16182351.293564167,
        y: -1857184.7728010786,
      },
      {
        latitude: -16.452467,
        longitude: -145.36866,
        time: "2025-10-11T00:38:33.000Z",
        depth: 3.7,
        x: -16182365.208500518,
        y: -1857180.9424228321,
      },
    ];

    var simplified = simplifyTrack(testTrack, 10, true);
    assert.equal(testTrack.length, 71);
    assert.equal(expected.length, 31);
    assert.equal(simplified.length, 31);
    assert.deepEqual(simplified, expected);
  });
});
